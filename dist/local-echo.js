var LocalEchoController=function(t){var e={};function r(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}r.r(e);var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.size=e,this.entries=[],this.cursor=0}return function(t,e,r){e&&i(t.prototype,e),r&&i(t,r)}(t,[{key:"push",value:function(t){""!==t.trim()&&(t!=this.entries[this.entries.length-1]&&(this.entries.push(t),this.entries.length>this.size&&this.entries.pop(0),this.cursor=this.entries.length))}},{key:"rewind",value:function(){this.cursor=this.entries.length}},{key:"getPrevious",value:function(){var t=Math.max(0,this.cursor-1);return this.cursor=t,this.entries[t]}},{key:"getNext",value:function(){var t=Math.min(this.entries.length,this.cursor+1);return this.cursor=t,this.entries[t]}}]),t}();function n(t){for(var e,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],s=/\w+/g;e=s.exec(t);)r?i.push(e.index):i.push(e.index+e[0].length);return i}function o(t,e){return n(t,!0).reverse().find(function(t){return t<e})}function u(t,e,r){for(var i=0,s=0,n=0;n<e;++n){"\n"==t.charAt(n)?(s=0,i+=1):(s+=1)>r&&(s=0,i+=1)}return{row:i,col:s}}function h(t,e){return u(t,t.length,e).row+1}function a(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var l=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.term=e,this.term.on("data",this.handleTermData.bind(this)),this.term.on("resize",this.handleTermResize.bind(this)),this.history=new s(r),this._autocompleteHandlers=[],this._active=!1,this._input="",this._cursor=0,this._activePrompt=null,this._termSize={cols:this.term.cols,rows:this.term.rows}}return function(t,e,r){e&&a(t.prototype,e),r&&a(t,r)}(t,[{key:"addAutocompleteHandler",value:function(t){this._autocompleteHandlers.push(t)}},{key:"removeAutocompleteHandler",value:function(t){var e=this._autocompleteHandlers.indexOf(t);-1!==e&&this._autocompleteHandlers.splice(e,1)}},{key:"read",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"> ";return new Promise(function(i,s){e.term.write(t),e._activePrompt={prompt:t,continuationPrompt:r,resolve:i,reject:s},e._input="",e._cursor=0,e._active=!0})}},{key:"abortRead",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"aborted";null!=this._activePrompt&&(this.term.write("\r\n"),this._activePrompt.reject(t),this._activePrompt=null),this._active=!1}},{key:"println",value:function(t){this.print(t+"\n")}},{key:"print",value:function(t){var e=t.replace(/[\r\n]+/g,"\n");this.term.write(e.replace(/\n/g,"\r\n"))}},{key:"applyPrompts",value:function(t){var e=(this._activePrompt||{}).prompt||"",r=(this._activePrompt||{}).continuationPrompt||"";return e+t.replace(/\n/g,"\n"+r)}},{key:"applyPromptOffset",value:function(t,e){return this.applyPrompts(t.substr(0,e)).length}},{key:"clearInput",value:function(){for(var t=this.applyPrompts(this._input),e=h(t,this._termSize.cols),r=u(t,this.applyPromptOffset(this._input,this._cursor),this._termSize.cols),i=(r.col,e-r.row-1),s=0;s<i;++s)term.write("[E");term.write("\r[K");for(s=1;s<e;++s)term.write("[F[K")}},{key:"setInput",value:function(t){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.clearInput();var e=this.applyPrompts(t);this.print(e),this._cursor>t.length&&(this._cursor=t.length);var r=this.applyPromptOffset(t,this._cursor),i=h(e,this._termSize.cols),s=u(e,r,this._termSize.cols),n=s.col,o=i-s.row-1;term.write("\r");for(var a=0;a<o;++a)term.write("[F");for(a=0;a<n;++a)this.term.write("[C");this._input=t}},{key:"setCursor",value:function(t){t<0&&(t=0),t>this._input.length&&(t=this._input.length);var e=this.applyPrompts(this._input),r=(h(e,this._termSize.cols),u(e,this.applyPromptOffset(this._input,this._cursor),this._termSize.cols)),i=r.col,s=r.row,n=u(e,this.applyPromptOffset(this._input,t),this._termSize.cols),o=n.col,a=n.row;if(a>s)for(var l=s;l<a;++l)term.write("[B");else for(var c=a;c<s;++c)term.write("[A");if(o>i)for(var p=i;p<o;++p)term.write("[C");else for(var f=o;f<i;++f)term.write("[D");this._cursor=t}},{key:"handleCursorMove",value:function(t){if(t>0){var e=Math.min(t,this._input.length-this._cursor);this.setCursor(this._cursor+e)}else if(t<0){var r=Math.max(t,-this._cursor);this.setCursor(this._cursor+r)}}},{key:"handleCursorErase",value:function(t){var e=this._cursor,r=this._input;if(t){if(e<=0)return;var i=r.substr(0,e-1)+r.substr(e);this.clearInput(),this._cursor-=1,this.setInput(i,!1)}else{var s=r.substr(0,e)+r.substr(e+1);this.setInput(s)}}},{key:"handleCursorInsert",value:function(t){var e=this._cursor,r=this._input,i=r.substr(0,e)+t+r.substr(e);this._cursor+=1,this.setInput(i)}},{key:"handleReadComplete",value:function(){this.history&&this.history.push(this._input),this._activePrompt&&(this._activePrompt.resolve(this._input),this._activePrompt=null),this.term.write("\r\n"),this._active=!1}},{key:"handleTermResize",value:function(t){var e=t.rows,r=t.cols;this.clearInput(),this._termSize={cols:r,rows:e},this.setInput(this._input,!1)}},{key:"handleTermData",value:function(t){var e=this;if(this._active)if(t.length>3&&27!==t.charCodeAt(0)){var r=t.replace(/[\r\n]+/g,"\r");Array.from(r).forEach(function(t){return e.handleData(t)})}else this.handleData(t)}},{key:"handleData",value:function(t){if(this._active){var e,r=t.charCodeAt(0);if(27==r)switch(t.substr(1)){case"[A":if(this.history){var i=this.history.getPrevious();i&&(this.setInput(i),this.setCursor(i.length))}break;case"[B":if(this.history){var s=this.history.getNext();s||(s=""),this.setInput(s),this.setCursor(s.length)}break;case"[D":this.handleCursorMove(-1);break;case"[C":this.handleCursorMove(1);break;case"[3~":this.handleCursorErase(!1);break;case"[F":this.setCursor(this._input.length);break;case"[H":this.setCursor(0);break;case"b":null!=(e=o(this._input,this._cursor))&&this.setCursor(e);break;case"f":null!=(e=function(t,e){return n(t,!1).find(function(t){return t>e})}(this._input,this._cursor))&&this.setCursor(e);break;case"":null!=(e=o(this._input,this._cursor))&&(this.setInput(this._input.substr(0,e)+this._input.substr(this._cursor)),this.setCursor(e))}else if(r<32||127===r)switch(t){case"\r":!function(t){return""!=t.trim()&&((t.match(/'/g)||[]).length%2!=0||(t.match(/"/g)||[]).length%2!=0||""==t.split(/(\|\||\||&&)/g).pop().trim()||!(!t.endsWith("\\")||t.endsWith("\\\\")))}(this._input)?this.handleReadComplete():this.handleCursorInsert("\n");break;case"":this.handleCursorErase(!0);break;case"\t":this.handleCursorInsert("    ");break;case"":this.setCursor(this._input.length),this.term.write("^C\r\n"+((this._activePrompt||{}).prompt||"")),this._input="",this._cursor=0,this.history&&this.history.rewind()}else this.handleCursorInsert(t)}}}]),t}();r.d(e,"HistoryController",function(){return s});e.default=l}]).default;
//# sourceMappingURL=local-echo.js.map